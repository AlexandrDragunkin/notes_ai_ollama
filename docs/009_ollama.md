# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–±—ã—Ç–∏–π–Ω–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

## –í–≤–µ–¥–µ–Ω–∏–µ  

–í –∫–æ–Ω—Å–æ–ª—å–Ω–æ–º 3D‚ÄëCAD‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –≥–¥–µ –º–æ–¥–µ–ª—å –º–µ–±–µ–ª–∏ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Python‚ÄëAPI (3.7), **—Å–æ–±—ã—Ç–∏–π–Ω–æ‚Äë–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (SOA)** –ø–æ–∑–≤–æ–ª—è–µ—Ç:

1. **–†–∞–∑–¥–µ–ª–∏—Ç—å –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫—É (—Ä–∞—Å—á—ë—Ç—ã, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏–∏) –∏ —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è** (–≤–∞–ª–∏–¥–∞—Ü–∏—é, –∫—ç—à, –≤—ã–≤–æ–¥, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).  
2. **–£–º–µ–Ω—å—à–∏—Ç—å —Å–≤—è–∑–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** ‚Äì –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –µ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç.  
3. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** ‚Äì –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è) ‚Äì –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª—É—à–∞—Ç–µ–ª—å.  
4. **–û–±–µ—Å–ø–µ—á–∏—Ç—å ‚Äúlive‚Äëupdate‚Äù** ‚Äì –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (—à–∏—Ä–∏–Ω–∞, —Ç–æ–ª—â–∏–Ω–∞) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–µ—Ä–µ—Å—á—ë—Ç—É –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º—ã—Ö —á–∞—Å—Ç–µ–π –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ —Ü–µ–ø–æ—á–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π.

–ù–∏–∂–µ ‚Äì –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ, –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–∫—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤ Python‚ÄØ3.7.

---

## 1. –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è

| –ü–æ–Ω—è—Ç–∏–µ | –ß—Ç–æ —ç—Ç–æ? | –ü—Ä–∏–º–µ—Ä –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –º–µ–±–µ–ª–∏ |
|---------|----------|---------------------------|
| **–°–æ–±—ã—Ç–∏–µ** | –ú–∞–ª–µ–Ω—å–∫–∏–π –æ–±—ä–µ–∫—Ç‚Äë—Å–æ–æ–±—â–µ–Ω–∏–µ, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π *—á—Ç–æ* –ø—Ä–æ–∏–∑–æ—à–ª–æ. | `ParamChanged(part='door', name='thickness', new_value=2.0)` |
| **–ò–∑–¥–∞—Ç–µ–ª—å (Publisher)** | –õ—é–±–æ–π –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π *–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç* —Å–æ–±—ã—Ç–∏–µ. | –ö–ª–∞—Å—Å `Door` –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—â–∏–Ω—ã. |
| **–ü–æ–¥–ø–∏—Å—á–∏–∫ (Subscriber / Listener)** | –§—É–Ω–∫—Ü–∏—è/–æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π *—Ä–µ–∞–≥–∏—Ä—É–µ—Ç* –Ω–∞ —Å–æ–±—ã—Ç–∏–µ. | –§—É–Ω–∫—Ü–∏—è `update_assembly` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≥–∞–±–∞—Ä–∏—Ç—ã –∫–æ—Ä–ø—É—Å–∞. |
| **–®–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π (Event Bus / Dispatcher)** | –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ø–æ—Å—Ä–µ–¥–Ω–∏–∫, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π —Å–æ–±—ã—Ç–∏–µ –æ—Ç –∏–∑–¥–∞—Ç–µ–ª—è –∏ –¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –µ–≥–æ –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º. | `EventBus.publish(event)`. |
| **–ö–æ–Ω–≤–µ–π–µ—Ä (Pipeline)** | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—à–∞–µ—Ç/–∏–∑–¥–∞—ë—Ç —Å–æ–±—ã—Ç–∏—è, –æ–±—Ä–∞–∑—É—è —Ü–µ–ø–æ—á–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏. | `ParamChanged ‚Üí validate ‚Üí recompute ‚Üí render`. |

---

## 2. –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —à–∏–Ω—ã

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã | –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤ Python‚ÄØ3.7 |
|------------|-------|--------|-----------------------------|
| **–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ—Å—Ç–∞—è —à–∏–Ω–∞** | –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ª–µ–≥–∫–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å. | –ù—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å boilerplate. | –°–º. –ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ. |
| **`blinker`** | –ú–∞–ª—ã–π, –ø–æ–ø—É–ª—è—Ä–Ω—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç namespace, weak‚Äërefs. | –¢—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É (`pip install blinker`). | `from blinker import signal` |
| **`pydispatcher`** | –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –∫–ª–∞—Å—Å‚Äë–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å. | –ë–æ–ª–µ–µ —Å—Ç–∞—Ä—ã–π, –º–µ–Ω–µ–µ –∞–∫—Ç–∏–≤–Ω—ã–π. | `pip install PyDispatcher` |
| **`asyncio` + `asyncio.Queue`** | –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤. | –¢—Ä–µ–±—É–µ—Ç `async`/`await`, —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö. | –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ Python‚ÄØ3.7. |

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ **—Å–∞–º–æ–π –ª—ë–≥–∫–æ–π —à–∏–Ω—ã** ‚Äì 20‚Äë30 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞. –ù–∏–∂–µ ‚Äì –µ—ë —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

---

## 3. –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —à–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π

```python
# event_bus.py
from collections import defaultdict
from typing import Callable, Any, Dict, List

class Event:
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π."""
    def __init__(self, **payload):
        self.__dict__.update(payload)

class EventBus:
    """–ü—Ä–æ—Å—Ç–æ–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä: –ø–æ–¥–ø–∏—Å–∫–∞ / –ø—É–±–ª–∏–∫–∞—Ü–∏—è."""
    _subscribers: Dict[type, List[Callable[[Event], None]]] = defaultdict(list)

    @classmethod
    def subscribe(cls, event_type: type, handler: Callable[[Event], None]) -> None:
        """
        –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ `event_type`.
        `handler` –ø–æ–ª—É—á–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ–±—ã—Ç–∏—è.
        """
        cls._subscribers[event_type].append(handler)

    @classmethod
    def publish(cls, event: Event) -> None:
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º."""
        for handler in cls._subscribers[type(event)]:
            try:
                handler(event)
            except Exception as exc:
                # –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ª–æ–≥–∏—Ä—É–µ–º, –∞ –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ –ø–µ—á–∞—Ç–∞–µ–º.
                print(f"[EventBus] –û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ {handler}: {exc}")

# -------------------------------------------------
# –ü—Ä–∏–º–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
class ParamChanged(Event):
    """–ü–∞—Ä–∞–º–µ—Ç—Ä –¥–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω—ë–Ω."""
    # payload: part (str), name (str), new_value (Any)

class PartCreated(Event):
    """–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —á–∞—Å—Ç—å –º–æ–¥–µ–ª–∏."""
    # payload: part (BasePart)

class AssemblyUpdated(Event):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–±–æ—Ä–∫–∞ (–æ–±—â–∏–µ –≥–∞–±–∞—Ä–∏—Ç—ã, –∫–æ–ª–ª–∏–∑–∏–∏)."""
    # payload: assembly (Assembly)
```

**–ü–æ—á–µ–º—É —Ç–∞–∫?**

- **–¢–∏–ø‚Äë–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞** (–ø–æ –∫–ª–∞—Å—Å—É —Å–æ–±—ã—Ç–∏—è) ‚Äì –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª–∞–≤–∏—à.  
- **Weak‚Äëref** –Ω–µ –Ω—É–∂–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ —à–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏; –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –º—É—Å–æ—Ä–∞ –æ–Ω–∏ –∏—Å—á–µ–∑–Ω—É—Ç —Å–∞–º–∏.  
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π** ‚Äì –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ä–∞—Å—á—ë—Ç–æ–≤, –∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å –≤ `asyncio`.

---

## 4. –ë–∞–∑–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ –º–µ–±–µ–ª–∏

```python
# parts.py
from dataclasses import dataclass, field
from typing import Tuple, List
import math
from event_bus import EventBus, PartCreated, ParamChanged

# ------------------------------
# –ö–ª–∞—Å—Å –æ–±—â–µ–π –¥–µ—Ç–∞–ª–∏
@dataclass
class BasePart:
    name: str
    width: float
    height: float
    depth: float
    material: str = "MDF"
    # –°–ø–∏—Å–æ–∫ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö CAD‚ÄëAPI
    cad_objects: List[Any] = field(default_factory=list)

    def __post_init__(self):
        # –°–æ–æ–±—â–∞–µ–º —Å–∏—Å—Ç–µ–º–µ, —á—Ç–æ –Ω–æ–≤–∞—è —á–∞—Å—Ç—å –ø–æ—è–≤–∏–ª–∞—Å—å
        EventBus.publish(PartCreated(part=self))

    # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    def set_param(self, param_name: str, value: float):
        if not hasattr(self, param_name):
            raise AttributeError(f"{self.__class__.__name__} –Ω–µ –∏–º–µ–µ—Ç –∞—Ç—Ä–∏–±—É—Ç–∞ {param_name}")
        setattr(self, param_name, value)
        EventBus.publish(ParamChanged(part=self.name, name=param_name, new_value=value))

# ------------------------------
# –ü—Ä–∏–º–µ—Ä —á–∞—Å—Ç–µ–π: –±–æ–∫–æ–≤–∏–Ω–∞, –∑–∞–¥–Ω—è—è —Å—Ç–µ–Ω–∫–∞, –¥–≤–µ—Ä—Ü–∞
class SidePanel(BasePart):
    def __init__(self, width, height, thickness):
        super().__init__(name="SidePanel",
                         width=width,
                         height=height,
                         depth=thickness)

class BackPanel(BasePart):
    def __init__(self, width, height, thickness):
        super().__init__(name="BackPanel",
                         width=width,
                         height=thickness,   # –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ depth = thickness
                         depth=height)

class Door(BasePart):
    def __init__(self, width, height, thickness):
        super().__init__(name="Door",
                         width=width,
                         height=height,
                         depth=thickness)

# -------------------------------------------------
# –ö–æ—Ä–æ–±–∫–∞ (Assembly) ‚Äì —Å–æ–±–∏—Ä–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –≤ –µ–¥–∏–Ω—É—é –º–æ–¥–µ–ª—å
class Assembly:
    def __init__(self, name: str):
        self.name = name
        self.parts: List[BasePart] = []
        self.bounding_box: Tuple[float, float, float] = (0, 0, 0)  # w, h, d

        # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è, –º–µ–Ω—è—é—â–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏—é
        EventBus.subscribe(PartCreated, self._on_part_created)
        EventBus.subscribe(ParamChanged, self._on_param_changed)

    # ----------------------------------------------
    def _on_part_created(self, ev: PartCreated):
        part = ev.part
        self.parts.append(part)
        self._recalc_bounding_box()
        # –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —Å—Ä–∞–∑—É –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –≤ CAD:
        self._create_cad_objects(part)

    def _on_param_changed(self, ev: ParamChanged):
        # –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ª—é–±–æ–π –∏–∑ –Ω–∞—à–∏—Ö —á–∞—Å—Ç–µ–π, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º.
        # –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –±—É–¥–µ–º –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–æ–±–∫–∏.
        self._recalc_bounding_box()
        # –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äì –æ–±–Ω–æ–≤–ª—è–µ–º CAD‚Äë–æ–±—ä–µ–∫—Ç—ã
        self._update_cad_for_part(ev.part)

    # ----------------------------------------------
    def _recalc_bounding_box(self):
        if not self.parts:
            self.bounding_box = (0, 0, 0)
            return
        w = max(p.width for p in self.parts)
        h = max(p.height for p in self.parts)
        d = max(p.depth for p in self.parts)
        self.bounding_box = (w, h, d)
        # –°–æ–±—ã—Ç–∏–µ –æ –ø–æ–ª–Ω–æ–π —Å–±–æ—Ä–∫–µ:
        EventBus.publish(AssemblyUpdated(assembly=self))

    # ----------------------------------------------
    # –û–±—ë—Ä—Ç–∫–∏ –Ω–∞–¥ CAD‚ÄëAPI (–∑–¥–µ—Å—å ‚Äì –ø—Å–µ–≤–¥–æ‚Äë—Ñ—É–Ω–∫—Ü–∏–∏)
    def _create_cad_objects(self, part: BasePart):
        """–°–æ–∑–¥–∞—ë—Ç CAD‚Äë–≥–µ–æ–º–µ—Ç—Ä–∏—é –¥–ª—è –Ω–æ–≤–æ–π –¥–µ—Ç–∞–ª–∏."""
        # –ü—Ä–∏–º–µ—Ä: api.create_box(width, height, depth, material)
        cad_obj = api.create_box(part.width, part.height, part.depth,
                                 material=part.material,
                                 name=part.name)
        part.cad_objects.append(cad_obj)

    def _update_cad_for_part(self, part_name: str):
        """–ù–∞–π—Ç–∏ —á–∞—Å—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å –µ—ë CAD‚Äë–æ–±—ä–µ–∫—Ç—ã (–ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å)."""
        part = next((p for p in self.parts if p.name == part_name), None)
        if part is None:
            return
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑ —Å—Ü–µ–Ω—ã
        for obj in part.cad_objects:
            api.delete(obj)
        part.cad_objects.clear()
        self._create_cad_objects(part)

# -------------------------------------------------
# –ü—Å–µ–≤–¥–æ‚ÄëCAD‚Äë–º–æ–¥—É–ª—å (–¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
class FakeCAD:
    """–≠–º—É–ª—è—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ API CAD‚Äë—Å–∏—Å—Ç–µ–º—ã."""
    def __init__(self):
        self.objects = []

    def create_box(self, w, h, d, material, name):
        obj = {"type": "box", "w": w, "h": h, "d": d,
               "material": material, "name": name}
        self.objects.append(obj)
        print(f"[CAD] –°–æ–∑–¥–∞–Ω {name}: {w}√ó{h}√ó{d} ({material})")
        return obj

    def delete(self, obj):
        self.objects.remove(obj)
        print(f"[CAD] –£–¥–∞–ª—ë–Ω {obj['name']}")

# –°–æ–∑–¥–∞—ë–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π API‚Äë–æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–¥–µ:
api = FakeCAD()
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥?

1. **`BasePart`** ‚Äì –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –≤—Å–µ—Ö –¥–µ—Ç–∞–ª–µ–π. –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `PartCreated`. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚Äì `ParamChanged`.
2. **`Assembly`** ‚Äì –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–±–æ—Ä–∫—É –∫–æ—Ä–æ–±–∫–∏. –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ–±–∞ —Å–æ–±—ã—Ç–∏—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è **bounding‚Äëbox**, **CAD‚Äë–æ–±—ä–µ–∫—Ç—ã** –∏ –ø—É–±–ª–∏–∫—É–µ—Ç `AssemblyUpdated` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.
3. **`EventBus`** ‚Äì —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±—â–∞—é—Ç—Å—è –±–µ–∑ –ø—Ä—è–º–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
4. **`FakeCAD`** ‚Äì –∏–º–∏—Ç–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ API (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à `cad_api`).

---

## 5. –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è (—Å–±–æ—Ä–∫–∞ —à–∫–∞—Ñ–∞)

```python
# main.py
from parts import SidePanel, BackPanel, Door, Assembly, EventBus, AssemblyUpdated

# 1Ô∏è‚É£ –°–æ–∑–¥–∞—ë–º —Å–±–æ—Ä–∫—É
cabinet = Assembly(name="–®–∫–∞—Ñ_1")

# 2Ô∏è‚É£ –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ –ø–æ–ª–Ω–æ–π —Å–±–æ—Ä–∫–∏ (–º–æ–∂–Ω–æ –≤–µ—Å—Ç–∏ –ª–æ–≥, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç)
def on_assembly_updated(ev):
    asm = ev.assembly
    w, h, d = asm.bounding_box
    print(f"[INFO] –°–±–æ—Ä–∫–∞ ¬´{asm.name}¬ª –æ–±–Ω–æ–≤–ª–µ–Ω–∞: {w:.1f}√ó{h:.1f}√ó{d:.1f} (W√óH√óD)")

EventBus.subscribe(AssemblyUpdated, on_assembly_updated)

# 3Ô∏è‚É£ –°–æ–∑–¥–∞—ë–º –¥–µ—Ç–∞–ª–∏ (–∫–∞–∂–¥–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç PartCreated)
SidePanel(width=800, height=1800, thickness=18)   # –ª–µ–≤–∞—è –±–æ–∫–æ–≤–∏–Ω–∞
SidePanel(width=800, height=1800, thickness=18)   # –ø—Ä–∞–≤–∞—è –±–æ–∫–æ–≤–∏–Ω–∞
BackPanel(width=800, height=1800, thickness=5)    # –∑–∞–¥–Ω—è—è —Å—Ç–µ–Ω–∫–∞
Door(width=600, height=1800, thickness=2)        # –¥–≤–µ—Ä—å

# 4Ô∏è‚É£ –ú–µ–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ¬´–Ω–∞ –ª–µ—Ç—É¬ª ‚Äì —Å–æ–±—ã—Ç–∏–µ ParamChanged –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç
#    –ø–µ—Ä–µ—Å—á—ë—Ç —Å–±–æ—Ä–∫–∏ –∏ –æ–±–Ω–æ–≤–∏—Ç CAD‚Äë–≥–µ–æ–º–µ—Ç—Ä–∏—é.
door = next(p for p in cabinet.parts if p.name == "Door")
door.set_param("width", 550)      # —Å—É–∂–∞–µ–º –¥–≤–µ—Ä—å
door.set_param("thickness", 3)    # –º–µ–Ω—è–µ–º —Ç–æ–ª—â–∏–Ω—É

# 5Ô∏è‚É£ –î–æ–±–∞–≤–ª—è–µ–º –æ—á–µ—Ä–µ–¥–Ω—É—é –¥–µ—Ç–∞–ª—å (–ø–æ–ª–∫–∞)
class Shelf(BasePart):
    def __init__(self, width, depth, thickness):
        super().__init__(name="Shelf",
                         width=width,
                         height=thickness,
                         depth=depth)

Shelf(width=800, height=30, thickness=18)  # –ø–æ–ª–∫–∞ 30‚ÄØmm —Ç–æ–ª—â–∏–Ω–æ–π

# –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ —É–∂–µ —Å–¥–µ–ª–∞–Ω –≤ —Å–ª—É—à–∞—Ç–µ–ª–µ on_assembly_updated.
```

**–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å (–ø—Ä–∏–º–µ—Ä):**
```
[CAD] –°–æ–∑–¥–∞–Ω SidePanel: 800√ó1800√ó18 (MDF)
[CAD] –°–æ–∑–¥–∞–Ω SidePanel: 800√ó1800√ó18 (MDF)
[CAD] –°–æ–∑–¥–∞–Ω BackPanel: 800√ó5√ó1800 (MDF)
[CAD] –°–æ–∑–¥–∞–Ω Door: 600√ó1800√ó2 (MDF)
[INFO] –°–±–æ—Ä–∫–∞ ¬´–®–∫–∞—Ñ_1¬ª –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 800.0√ó1800.0√ó1800.0 (W√óH√óD)
[CAD] –£–¥–∞–ª—ë–Ω Door
[CAD] –°–æ–∑–¥–∞–Ω Door: 550.0√ó1800.0√ó2 (MDF)
[INFO] –°–±–æ—Ä–∫–∞ ¬´–®–∫–∞—Ñ_1¬ª –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 800.0√ó1800.0√ó1800.0 (W√óH√óD)
[CAD] –£–¥–∞–ª—ë–Ω Door
[CAD] –°–æ–∑–¥–∞–Ω Door: 550.0√ó1800.0√ó3 (MDF)
[INFO] –°–±–æ—Ä–∫–∞ ¬´–®–∫–∞—Ñ_1¬ª –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 800.0√ó1800.0√ó1800.0 (W√óH√óD)
[CAD] –°–æ–∑–¥–∞–Ω Shelf: 800√ó30.0√ó18 (MDF)
[INFO] –°–±–æ—Ä–∫–∞ ¬´–®–∫–∞—Ñ_1¬ª –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 800.0√ó1800.0√ó1800.0 (W√óH√óD)
```

---

## 6. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–æ–±—ã—Ç–∏–π

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å | –ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ |
|---------|--------------------|----------------------------------------|
| `ParamChanged` | –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–∏ (—à–∏—Ä–∏–Ω–∞, –≤—ã—Å–æ—Ç–∞, –º–∞—Ç–µ—Ä–∏–∞–ª). | –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, –ø–µ—Ä–µ—Å—á—ë—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏. |
| `PartCreated` | –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ `BasePart`. | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–±–æ—Ä–∫–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö. |
| `AssemblyUpdated` | –ö–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –≥–∞–±–∞—Ä–∏—Ç—ã/—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Å–µ–π —Å–±–æ—Ä–∫–∏. | –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á—ë—Ç–∞ –≤–µ—Å–∞, —ç–∫—Å–ø–æ—Ä—Ç BOM (Bill‚Äëof‚ÄëMaterials), –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π. |
| `CollisionDetected` | –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –¥–µ—Ç–∞–ª–µ–π. | –í—ã–≤–æ–¥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–º–µ—â–µ–Ω–∏–µ/—Å–∫–µ–π–ª–∏–Ω–≥. |
| `ExportReady` | –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É (STL, STEP). | –ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ `api.export(file_path)`. |
| `UserCommand` | –ü—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω—Å–æ–ª—å (–µ—Å–ª–∏ —É –≤–∞—Å REPL‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å). | –ü—Ä–∏–≤—è–∑—ã–≤–∞–Ω–∏–µ –∫ –æ—Ç–¥–µ–ª—å–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –∫–æ–º–∞–Ω–¥. |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–æ–º–∞–Ω–¥—ã:**

```python
class UserCommand(Event):
    """–°–æ–±—ã—Ç–∏–µ, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–µ –≤ REPL."""
    # payload: cmd (str), args (list)

def repl_loop():
    while True:
        line = input(">>> ").strip()
        if not line:
            continue
        parts = line.split()
        EventBus.publish(UserCommand(cmd=parts[0], args=parts[1:]))

# –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:
def on_user_command(ev: UserCommand):
    if ev.cmd == "add_shelf":
        width = float(ev.args[0])
        depth = float(ev.args[1])
        thickness = float(ev.args[2])
        Shelf(width=width, depth=depth, thickness=thickness)

EventBus.subscribe(UserCommand, on_user_command)
```

---

## 7. –ö–∞–∫ —Å–≤—è–∑–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º CAD‚ÄëAPI

### 7.1. –û–±—ä–µ–∫—Ç—ã‚Äë–æ–±—ë—Ä—Ç–∫–∏

–ï—Å–ª–∏ API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–∏–ø–∞:

```python
obj = cad.create_box(w, h, d, material)
cad.set_position(obj, x, y, z)
cad.delete(obj)
```

–°–æ–∑–¥–∞–π—Ç–µ **–∞–¥–∞–ø—Ç–µ—Ä** –≤ –≤–∏–¥–µ –Ω–µ–±–æ–ª—å—à–æ–≥–æ –∫–ª–∞—Å—Å–∞‚Äë–æ–±—ë—Ä—Ç–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –∏—Ö –≤ –≤—ã–∑–æ–≤—ã API.

```python
class CADAdapter:
    def __init__(self, api):
        self.api = api
        EventBus.subscribe(PartCreated, self._on_part_created)
        EventBus.subscribe(ParamChanged, self._on_param_changed)
        EventBus.subscribe(AssemblyUpdated, self._on_assembly_updated)

    def _on_part_created(self, ev: PartCreated):
        part = ev.part
        obj = self.api.create_box(part.width, part.height, part.depth,
                                  material=part.material,
                                  name=part.name)
        part.cad_objects.append(obj)

    def _on_param_changed(self, ev: ParamChanged):
        part_name = ev.part
        part = next(p for p in Assembly.instances[0].parts if p.name == part_name)  # —É–ø—Ä–æ—â–µ–Ω–∏–µ
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—ä–µ–∫—Ç –∏ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π
        for obj in part.cad_objects:
            self.api.delete(obj)
        part.cad_objects.clear()
        self._on_part_created(PartCreated(part=part))

    def _on_assembly_updated(self, ev: AssemblyUpdated):
        # –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–ª—è–µ–º ¬´–≥—Ä–∞–Ω–∏—Ü—ã¬ª —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –≤ CAD
        w, h, d = ev.assembly.bounding_box
        self.api.set_workspace_dimensions(w, h, d)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
cad_adapter = CADAdapter(api)   # `api` ‚Äì –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç CAD‚ÄëSDK
```

### 7.2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã

–ï—Å–ª–∏ —Ä–∞—Å—á—ë—Ç –≥–µ–æ–º–µ—Ç—Ä–∏–∏ —Ç—è–∂—ë–ª—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞—Å–∞–¥–æ–≤ —Å —Ä–µ–∑—å–±–æ–π), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `asyncio` –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ:

```python
import asyncio

class AsyncCADAdapter(CADAdapter):
    async def _on_part_created(self, ev: PartCreated):
        part = ev.part
        # –î–æ–ª–≥–∏–π –ø—Ä–æ—Ü–µ—Å—Å ‚Äì –±—É–¥–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–∞—Å–∫–µ
        await asyncio.to_thread(self.api.create_complex_part, part)

# –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞
async def main():
    # –í—Å—ë, —á—Ç–æ –≤—ã—à–µ
    await asyncio.sleep(0)   # ¬´–ø—Ä–æ–∫–∞—á–∫–∞¬ª —Å–æ–±—ã—Ç–∏–π
    # –¥–∞–ª—å—à–µ ‚Äì –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–º–∞–Ω–¥—ã, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è

asyncio.run(main())
```

---

## 8. –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

| –ü—Ä–æ–±–ª–µ–º–∞ | –ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å |
|----------|-------------------|
| **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è** (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ -> —Å–æ–±—ã—Ç–∏–µ -> –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—è–µ—Ç —Ç–æ—Ç –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä). | –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ `if new_value == old_value: return`. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å **—Ñ–ª–∞–≥ ‚Äúprocessing‚Äù** –≤ `BasePart`. |
| **–õ–∏—à–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞** (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–µ—Ä–µ—Å—á—ë—Ç–æ–≤ –ø—Ä–∏ –ø–∞–∫–µ—Ç–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö). | –ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ ¬´—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é¬ª ‚Äì —Å–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—ã—Ç–∏–µ `BatchUpdateStart` / `BatchUpdateEnd`, –∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—é—Ç –¥–µ–π—Å—Ç–≤–∏—è –¥–æ –∫–æ–Ω—Ü–∞. |
| **–£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏** (–ø–æ–¥–ø–∏—Å—á–∏–∫–∏, –Ω–µ –æ—Ç–ø–∏—Å–∞–Ω–Ω—ã–µ). | –ü—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –≤—ã–∑—ã–≤–∞–π—Ç–µ `EventBus.unsubscribe(handler)`. –í –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –±–µ–∑ –æ—Ç–ø–∏—Å–∫–∏; –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ `weakref.WeakSet`. |
| **–¢—Ä—É–¥–Ω–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π**. | –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–≥–µ—Ä –≤ `EventBus.publish`, –≤—ã–≤–æ–¥—è—â–∏–π `event.__class__.__name__` –∏ –∏—Å—Ç–æ—á–Ω–∏–∫. |
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤**. | –ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ –ø–æ—Ä—è–¥–æ–∫: –∫–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º** (–º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–∞). |

---

## 9. –ß–µ–∫‚Äë–ª–∏—Å—Ç –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è SOA –≤ –≤–∞—à CAD‚Äë—Å–∫—Ä–∏–ø—Ç

1. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è**  
   - –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω—ë–Ω (`ParamChanged`)  
   - –î–µ—Ç–∞–ª—å —Å–æ–∑–¥–∞–Ω–∞ (`PartCreated`)  
   - –°–±–æ—Ä–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É (`ExportReady`)  
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª –∫–æ–º–∞–Ω–¥—É (`UserCommand`)  

2. **–°–æ–∑–¥–∞–π—Ç–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —à–∏–Ω—É** (`EventBus`).  
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤–µ–∑–¥–µ, –≥–¥–µ –Ω—É–∂–µ–Ω `publish`/`subscribe`.  

3. **–û–±—ë—Ä–Ω–∏—Ç–µ –≤—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ API‚Äë–≤—ã–∑–æ–≤—ã CAD** –≤ –∞–¥–∞–ø—Ç–µ—Ä, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ —Å–æ–±—ã—Ç–∏—è.  

4. **–ü–µ—Ä–µ–ø–∏—à–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ ¬´–ø—Ä—è–º—ã–µ¬ª –≤—ã–∑–æ–≤—ã** (`door.width = 600`) –Ω–∞ **–º–µ—Ç–æ–¥—ã, –≥–µ–Ω–µ—Ä–∏—Ä—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏–µ** (`door.set_param('width', 600)`).  

5. **–î–æ–±–∞–≤—å—Ç–µ —Å–ª—É—à–∞—Ç–µ–ª–∏**:
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.  
   - –ü–µ—Ä–µ—Å—á—ë—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ —Å–±–æ—Ä–∫–∏.  
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏/—ç–∫—Å–ø–æ—Ä—Ç.  

6. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ**:  
   - –î–æ–±–∞–≤—å—Ç–µ ¬´–º–æ–∫¬ª‚Äë—à–∏–Ω—É (–∑–∞–ø–∏—Å—ã–≤–∞—é—â—É—é —Å–ø–∏—Å–æ–∫ –≤—ã–∑–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π).  
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤—ã–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.  

7. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ**:  
   - –ü—Ä–∏ –ø–∞–∫–µ—Ç–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `BatchUpdateStart/End`.  
   - –ü—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–∞—Ö ‚Äì `asyncio`/`ThreadPoolExecutor`.  

8. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ**:  
   - –°—Ö–µ–º—É —Å–æ–±—ã—Ç–∏–π (–∫–∞–∫ –≤ UML‚Äë–¥–∏–∞–≥—Ä–∞–º–º–µ).  
   - –°–æ–≥–ª–∞—à–µ–Ω–∏—è: –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å –∫–∞–∫–∏–µ —á–∞—Å—Ç–∏.  

---

## 10. –ü–æ–ª–Ω—ã–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä (–æ–¥–∏–Ω —Ñ–∞–π–ª)

```python
# furniture_event_demo.py
import sys
from collections import defaultdict
from dataclasses import dataclass, field

# ---------- –®–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π ----------
class Event: pass

class EventBus:
    _subs = defaultdict(list)
    @classmethod
    def subscribe(cls, ev_type, handler):
        cls._subs[ev_type].append(handler)
    @classmethod
    def publish(cls, ev):
        for h in cls._subs[type(ev)]:
            h(ev)

# ---------- –°–æ–±—ã—Ç–∏—è ----------
class ParamChanged(Event):
    def __init__(self, part, name, new): self.part, self.name, self.new = part, name, new
class PartCreated(Event):
    def __init__(self, part): self.part = part
class AssemblyUpdated(Event):
    def __init__(self, assembly): self.assembly = assembly

# ---------- –ú–æ–¥–µ–ª—å ----------
@dataclass
class Part:
    name: str
    w: float; h: float; d: float
    def set(self, name, value):
        setattr(self, name, value)
        EventBus.publish(ParamChanged(self, name, value))
    def __post_init__(self):
        EventBus.publish(PartCreated(self))

# ---------- –°–±–æ—Ä–∫–∞ ----------
class Assembly:
    def __init__(self):
        self.parts = []
        EventBus.subscribe(PartCreated, self._add)
        EventBus.subscribe(ParamChanged, self._recalc)
    def _add(self, ev): self.parts.append(ev.part); self._recalc(ev)
    def _recalc(self, ev):
        if not self.parts: return
        w = max(p.w for p in self.parts)
        h = max(p.h for p in self.parts)
        d = max(p.d for p in self.parts)
        self.bb = (w, h, d)
        EventBus.publish(AssemblyUpdated(self))

# ---------- –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ----------
def on_assembly_updated(ev):
    print(f"–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–±–æ—Ä–∫–∞: BB={ev.assembly.bb}")

EventBus.subscribe(AssemblyUpdated, on_assembly_updated)

asm = Assembly()
Side = Part("Side", w=800, h=1800, d=18)
Back = Part("Back", w=800, h=5,   d=1800)
Door = Part("Door", w=600, h=1800, d=2)

Door.set('w', 550)               # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ParamChanged ‚Üí –ø–µ—Ä–µ—Å—á—ë—Ç

# –í—ã–≤–æ–¥:
# –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–±–æ—Ä–∫–∞: BB=(800, 1800, 1800)
# –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–±–æ—Ä–∫–∞: BB=(800, 1800, 1800)
# ...
```

> **–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ** –≤–º–µ—Å—Ç–æ `print` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `logging`, –∞ –≤–º–µ—Å—Ç–æ `print` –≤ CAD‚Äë–∞–¥–∞–ø—Ç–µ—Ä–µ ‚Äì –≤—ã–∑–æ–≤—ã –≤–∞—à–µ–≥–æ SDK (—Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤, —ç–∫—Å–ø–æ—Ä—Ç).

---

## 11. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

- **–°–æ–±—ã—Ç–∏—è** –ø–æ–∑–≤–æ–ª—è—é—Ç –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç ¬´–∂–µ—Å—Ç–∫–æ–π¬ª —Å–≤—è–∑—å –º–µ–∂–¥—É —Ä–∞—Å—á—ë—Ç–∞–º–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π.  
- **EventBus** –≤ Python‚ÄØ3.7 –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫; –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ ¬´–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è¬ª —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ `blinker` –∏–ª–∏ `pydispatcher`.  
- **–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Å–æ–±—ã—Ç–∏—è –∑–∞—Ä–∞–Ω–µ–µ** (—á—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è, –∫—Ç–æ –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å) ‚Äì —ç—Ç–æ —É—Å–∫–æ—Ä–∏—Ç –¥–∞–ª—å–Ω–µ–π—à–µ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞.  
- **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å—á—ë—Ç–æ–≤** ‚Äì –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∞—Ç—á‚Äë–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.  
- **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ**: –º–æ–∫‚Äë–±–∏—Ç —à–∏–Ω—ã –ø–æ–º–æ–≥–∞–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–∞–≥–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω—É–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ª–∏—à–Ω–∏—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

–°–ª–µ–¥—É—è —ç—Ç–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º, –≤–∞—à –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π 3D‚ÄëCAD‚Äë—Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç **–≥–∏–±–∫–∏–º, —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–º –∏ –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º**, –∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è BOM, —ç–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã) —Å—Ç–∞–Ω–µ—Ç –ø—Ä–æ—Å—Ç—ã–º –≤–æ–ø—Ä–æ—Å–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö —Å–ª—É—à–∞—Ç–µ–ª–µ–π. üöÄ